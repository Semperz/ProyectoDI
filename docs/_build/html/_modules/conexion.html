<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>conexion &#8212; documentación de prietogarcia - 0.0.1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=6fcc102b"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=f85f4cfb"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Código fuente para conexion</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtSql</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">var</span>


<div class="viewcode-block" id="Conexion">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Conexion</span><span class="p">:</span>


<div class="viewcode-block" id="Conexion.db_conexion">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.db_conexion">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">db_conexion</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: False or True</span>
<span class="sd">        :rtype: Boolean</span>

<span class="sd">        Módulo de conexión a la base de datos</span>
<span class="sd">        Si exito True, else False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verifica si el archivo de base de datos existe</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;bbdd.sqlite&#39;</span><span class="p">):</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;El archivo de la base de datos no existe.&#39;</span><span class="p">,</span>
                                           <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Crear la conexión con la base de datos SQLite</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlDatabase</span><span class="o">.</span><span class="n">addDatabase</span><span class="p">(</span><span class="s1">&#39;QSQLITE&#39;</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setDatabaseName</span><span class="p">(</span><span class="s1">&#39;bbdd.sqlite&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">open</span><span class="p">():</span>
            <span class="c1"># Verificar si la base de datos contiene tablas</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>  <span class="c1"># Si no hay tablas</span>
                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Base de datos vacía o no válida.&#39;</span><span class="p">,</span>
                                               <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Icon</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowIcon</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s1">&#39;img/icono.svg&#39;</span><span class="p">))</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Aviso&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Conexión Base de Datos realizada&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span>
                    <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Aceptar&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;No se pudo abrir la base de datos.&#39;</span><span class="p">,</span>
                                           <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listarProvincias">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listarProvincias">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listarProvincias</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: lista provincias</span>
<span class="sd">        :rtype: bytearray</span>

<span class="sd">        Metodo que devuelve una lista de provincias</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listaProv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM provincias&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">listaProv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">listaProv</span></div>

<div class="viewcode-block" id="Conexion.listarMunicipios">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listarMunicipios">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listarMunicipios</span><span class="p">(</span><span class="n">provincia</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: provincia</span>
<span class="sd">        :type provincia: str</span>
<span class="sd">        :return: lista municipios</span>
<span class="sd">        :rtype: bytearray</span>

<span class="sd">        Metodo que devuelve una lista de municipios de una provincia</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listaMuni</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM municipios&quot;</span>
                      <span class="s2">&quot; WHERE fk_idprov = (SELECT idprov FROM provincias WHERE provincia = :provincia)&quot;</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:provincia&quot;</span><span class="p">,</span> <span class="n">provincia</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">listaMuni</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">listaMuni</span></div>


<div class="viewcode-block" id="Conexion.listarMuniSinProv">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listarMuniSinProv">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listarMuniSinProv</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: lista municipios</span>
<span class="sd">        :rtype: bytearray</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">listaMuni</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM municipios&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error ejecutando la consulta:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">listaMuni</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">listaMuni</span></div>


<div class="viewcode-block" id="Conexion.altaCliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaCliente">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaCliente</span><span class="p">(</span><span class="n">nuevoCli</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: true o false</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        Metodo que da de alta un cliente en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into clientes (dnicli, altacli, apelcli, nomecli, emailcli, movilcli, &quot;</span>
                          <span class="s2">&quot; dircli, provcli, municli ) VALUES (:dnicli, :altacli, :apelcli, :nomecli, &quot;</span>
                          <span class="s2">&quot; :emailcli, :movilcli, :dircli, :provcli, :municli)&quot;</span><span class="p">)</span>
            <span class="n">columnas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dnicli&#39;</span><span class="p">,</span> <span class="s1">&#39;altacli&#39;</span><span class="p">,</span> <span class="s1">&#39;apelcli&#39;</span><span class="p">,</span> <span class="s1">&#39;nomecli&#39;</span><span class="p">,</span> <span class="s1">&#39;emailcli&#39;</span><span class="p">,</span> <span class="s1">&#39;movilcli&#39;</span><span class="p">,</span> <span class="s1">&#39;dircli&#39;</span><span class="p">,</span> <span class="s1">&#39;provcli&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;municli&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columnas</span><span class="p">)):</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">nuevoCli</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Conexion.listadoClientes">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoClientes">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoClientes</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: listado de clientes</span>
<span class="sd">        :rtype: bytearray</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">searchBtn</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnBuscarcli</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">DniCliente</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtDnicli</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">historicocli</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkHistoriacli</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">searchBtn</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes WHERE dnicli = :dnicli ORDER BY apelcli, nomecli ASC&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dnicli&quot;</span><span class="p">,</span> <span class="n">DniCliente</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">historicocli</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes WHERE bajacli is NULL ORDER BY apelcli, nomecli ASC &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>
            <span class="k">elif</span> <span class="n">historicocli</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes ORDER BY apelcli, nomecli ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado en conexión&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.datosOneCliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneCliente">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneCliente</span><span class="p">(</span><span class="n">DNI</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: dni cliente</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :return: datos de un cliente</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Devuelve los datos de un cliente</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes WHERE dnicli = :DNI&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:DNI&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">DNI</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos un cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.modifCliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modifCliente">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifCliente</span><span class="p">(</span><span class="n">registro</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: datos del cliente a modificar</span>
<span class="sd">        :type registro: list</span>
<span class="sd">        :return: éxito de la operación</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Modifica los datos de un cliente</span>
<span class="sd">        Devuelve true si se realiza correctamente, sino false</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;select count(*) from clientes where dnicli = :dni&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                        <span class="n">query2</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE clientes set altacli = :altacli, apelcli = :apelcli, nomecli = :nomecli, &quot;</span>
                                      <span class="s2">&quot; emailcli = :emailcli, movilcli = :movilcli, dircli = :dircli, provcli = :provcli, &quot;</span>
                                      <span class="s2">&quot; municli = :municli, bajacli = :bajacli where dnicli = :dnicli&quot;</span><span class="p">)</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dnicli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:altacli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:apelcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:nomecli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:emailcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movilcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dircli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:provcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:municli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">registro</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajacli&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">())</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajacli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">query2</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">query2</span><span class="o">.</span><span class="n">numRowsAffected</span><span class="p">())</span>
                            <span class="k">return</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error modificar cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.bajaCliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaCliente">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaCliente</span><span class="p">(</span><span class="n">datos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">          :param: dni del cliente y fecha de baja</span>
<span class="sd">          :type datos: list</span>
<span class="sd">          :return: éxito de la operación</span>
<span class="sd">          :rtype: bool</span>

<span class="sd">          Da de baja al cliente</span>
<span class="sd">          No elimina al cliente de la base de datos</span>
<span class="sd">          Devuelve true si se realiza correctamente, sino false</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE clientes set bajacli = :bajacli &quot;</span>
                          <span class="s2">&quot;where dnicli = :dnicli&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajacli&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dnicli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">datos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error baja cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gestión de propiedades</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Conexion.altaTipoprop">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaTipoprop">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaTipoprop</span><span class="p">(</span><span class="n">tipo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: nombre del tipo de propiedad</span>
<span class="sd">        :type tipo: str</span>
<span class="sd">        :return: operacion exitosa</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Añade el tipo de propiedad, devolviendo true</span>
<span class="sd">        Devuelve false si ya existe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into tipoprop (tipo) VALUES (:tipo)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo&quot;</span><span class="p">,</span> <span class="n">tipo</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">registro</span> <span class="o">=</span> <span class="n">Conexion</span><span class="o">.</span><span class="n">cargarTipoprop</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">registro</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error alta tipo&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="Conexion.bajaTipoprop">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaTipoprop">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaTipoprop</span><span class="p">(</span><span class="n">tipo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: tipo de propiedad a eliminar</span>
<span class="sd">        :type tipo: str</span>
<span class="sd">        :return: operacion exitosa</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Elimina el tipo de prop si existe, devolviendo true</span>
<span class="sd">        Devuelve false si no existe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE from tipoprop where tipo = :tipo&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo&quot;</span><span class="p">,</span> <span class="n">tipo</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT tipo FROM tipoprop order by tipo ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
                    <span class="k">return</span> <span class="n">registro</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error alta tipo&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.cargarTipoprop">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargarTipoprop">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargarTipoprop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: listado de tipos de propiedad</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Devuelve los tipos de propiedades almacenados en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM tipoprop order by tipo ASC&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
                <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error cargar tipo&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.altaPropiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaPropiedad">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaPropiedad</span><span class="p">(</span><span class="n">propiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">         :param propiedad: datos de la propiedad a dar de alta</span>
<span class="sd">         :type propiedad: list</span>
<span class="sd">         :return: operacion exitosa</span>
<span class="sd">         :rtype: bool</span>

<span class="sd">         Da de alta una propiedad con los datos pasados por parámetro</span>
<span class="sd">         Devuelve true si la operación es exitosa, false en caso contrario</span>

<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into propiedades (fechaprop, dirprop, provpro, muniprop, tipoprop, &quot;</span>
                          <span class="s2">&quot; habprop, banosprop, superprop, prealquilerprop, prevenprop, CPprop, descriprop,&quot;</span>
                          <span class="s2">&quot;tipoperprop, estadoprop, nomeprop, movilprop ) VALUES (:fechaprop, :dirprop, :provpro, :muniprop, &quot;</span>
                          <span class="s2">&quot; :tipoprop, :habprop, :banosprop, :superprop, :prealquilerprop, :prevenprop, :CPprop,&quot;</span>
                          <span class="s2">&quot; :descriprop, :tipoperprop, :estadoprop, :nomeprop, :movilprop)&quot;</span><span class="p">)</span>
            <span class="n">columnas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fechaprop&#39;</span><span class="p">,</span> <span class="s1">&#39;dirprop&#39;</span><span class="p">,</span> <span class="s1">&#39;provpro&#39;</span><span class="p">,</span> <span class="s1">&#39;muniprop&#39;</span><span class="p">,</span> <span class="s1">&#39;tipoprop&#39;</span>
                <span class="p">,</span> <span class="s1">&#39;habprop&#39;</span><span class="p">,</span> <span class="s1">&#39;banosprop&#39;</span><span class="p">,</span> <span class="s1">&#39;superprop&#39;</span><span class="p">,</span> <span class="s1">&#39;prealquilerprop&#39;</span><span class="p">,</span> <span class="s1">&#39;prevenprop&#39;</span>
                <span class="p">,</span> <span class="s1">&#39;CPprop&#39;</span><span class="p">,</span> <span class="s1">&#39;descriprop&#39;</span><span class="p">,</span> <span class="s1">&#39;tipoperprop&#39;</span><span class="p">,</span> <span class="s1">&#39;estadoprop&#39;</span><span class="p">,</span> <span class="s1">&#39;nomeprop&#39;</span><span class="p">,</span> <span class="s1">&#39;movilprop&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columnas</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;habprop&#39;</span> <span class="ow">or</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;banosprop&#39;</span> <span class="ow">or</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;movilprop&#39;</span><span class="p">:</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;tipoperprop&#39;</span><span class="p">:</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">propiedad</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Conexion.listadoPropiedades">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoPropiedades">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoPropiedades</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: lista de propiedades registradas siguiendo condiciones</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Devuelve la lista de propiedades que existen en la base de datos</span>
<span class="sd">        siguiendo X condiciones (botón de historico, buscar por tipo de propiedad...)</span>
<span class="sd">        para mostrarla en la tabla</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">historicoprop</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkHistoricoprop</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">muniActual</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbMuniprop</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">tipoProp</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbTipoprop</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">searchBtn</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnBuscartipoprop</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">historicoprop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">searchBtn</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades ORDER BY idprop ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>

            <span class="k">elif</span> <span class="n">historicoprop</span> <span class="ow">and</span> <span class="n">searchBtn</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE muniprop = :muniprop AND tipoprop = :tipoprop ORDER BY idprop ASC&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:muniprop&quot;</span><span class="p">,</span> <span class="n">muniActual</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipoprop&quot;</span><span class="p">,</span> <span class="n">tipoProp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">historicoprop</span> <span class="ow">and</span> <span class="n">searchBtn</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE bajaprop IS NULL AND muniprop = :muniprop AND tipoprop = :tipoprop &quot;</span>
                              <span class="s2">&quot;ORDER BY idprop ASC&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:muniprop&quot;</span><span class="p">,</span> <span class="n">muniActual</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipoprop&quot;</span><span class="p">,</span> <span class="n">tipoProp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE bajaprop IS NULL ORDER BY idprop ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado en conexión&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.datosOnePropiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOnePropiedad">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOnePropiedad</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: identificador de una propiedad</span>
<span class="sd">        :type ID: int</span>
<span class="sd">        :return: datos de la propiedad</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Devuelve la información de una propiedad a partir de su código identificativo</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE idprop = :ID&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:ID&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ID</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos un cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.bajaPropiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaPropiedad">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaPropiedad</span><span class="p">(</span><span class="n">datos</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">               :param: lista de código de la propiedad, y su fecha de baja</span>
<span class="sd">               :type datos: list</span>
<span class="sd">               :return: operación exitosa</span>
<span class="sd">               :rtype: bool</span>

<span class="sd">               Da de baja (no elimina) a la propiedad del código especificado</span>
<span class="sd">               devuelve true si la operación se realiza correctamente, false en caso contrario</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE propiedades set bajaprop = :bajaprop &quot;</span>
                          <span class="s2">&quot;where idprop = :idprop&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaprop&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idprop&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">datos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error baja propiedad&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.modifPropiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modifPropiedad">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifPropiedad</span><span class="p">(</span><span class="n">registro</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">               :param: datos modificados de la propiedad</span>
<span class="sd">               :type registro: list</span>
<span class="sd">               :return: operacion existosa</span>
<span class="sd">               :rtype: bool</span>

<span class="sd">               Modifica los datos de la propiedad pasada por parámetros</span>
<span class="sd">               Devuelve true si la operación se realiza correctamente, false en caso contrario</span>

<span class="sd">       &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;select count(*) from propiedades where idprop = :idprop&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idprop&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                        <span class="n">query2</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                        <span class="n">query2</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE propiedades set fechaprop = :fechaprop, bajaprop = :bajaprop, dirprop = :dirprop, provpro = :provpro, &quot;</span>
                                      <span class="s2">&quot; muniprop = :muniprop, tipoprop = :tipoprop, habprop = :habprop, banosprop = :banosprop, &quot;</span>
                                      <span class="s2">&quot; superprop = :superprop, prealquilerprop = :prealquilerprop, prevenprop = :prevenprop, CPprop = :CPprop, &quot;</span>
                                       <span class="s2">&quot;descriprop = :descriprop, tipoperprop = :tipoperprop, estadoprop = :estadoprop, nomeprop = :nomeprop, movilprop = :movilprop where idprop = :idprop&quot;</span><span class="p">)</span>

                        <span class="n">columnas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;idprop&#39;</span><span class="p">,</span><span class="s1">&#39;fechaprop&#39;</span><span class="p">,</span> <span class="s1">&#39;bajaprop&#39;</span><span class="p">,</span> <span class="s1">&#39;dirprop&#39;</span><span class="p">,</span> <span class="s1">&#39;provpro&#39;</span><span class="p">,</span> <span class="s1">&#39;muniprop&#39;</span><span class="p">,</span> <span class="s1">&#39;tipoprop&#39;</span>
                            <span class="p">,</span> <span class="s1">&#39;habprop&#39;</span><span class="p">,</span> <span class="s1">&#39;banosprop&#39;</span><span class="p">,</span> <span class="s1">&#39;superprop&#39;</span><span class="p">,</span> <span class="s1">&#39;prealquilerprop&#39;</span><span class="p">,</span> <span class="s1">&#39;prevenprop&#39;</span>
                            <span class="p">,</span> <span class="s1">&#39;CPprop&#39;</span><span class="p">,</span> <span class="s1">&#39;descriprop&#39;</span><span class="p">,</span> <span class="s1">&#39;tipoperprop&#39;</span><span class="p">,</span> <span class="s1">&#39;estadoprop&#39;</span><span class="p">,</span> <span class="s1">&#39;nomeprop&#39;</span><span class="p">,</span> <span class="s1">&#39;movilprop&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columnas</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;idprop&#39;</span> <span class="ow">or</span>  <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;habprop&#39;</span> <span class="ow">or</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;banosprop&#39;</span> <span class="ow">or</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;movilprop&#39;</span><span class="p">:</span>
                                <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                            <span class="k">elif</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bajaprop&#39;</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">registro</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                    <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaprop&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">())</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                            <span class="k">elif</span> <span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;tipoperprop&#39;</span><span class="p">:</span>
                                <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">registro</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

                        <span class="k">if</span> <span class="n">query2</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                            <span class="k">return</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error modificar cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>

<div class="viewcode-block" id="Conexion.listadoAllPropiedades">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoAllPropiedades">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoAllPropiedades</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">              :return: lista de todas las propiedades registradas</span>
<span class="sd">              :rtype: list</span>

<span class="sd">              Devuelve la lista de propiedades que existen en la base de datos</span>

<span class="sd">              &quot;&quot;&quot;</span>
        <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades ORDER BY idprop ASC&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado en conexión&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>




<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Pestaña vendedores</span>
<span class="sd">    &#39;&#39;&#39;</span>


<div class="viewcode-block" id="Conexion.altaVendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaVendedor">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaVendedor</span><span class="p">(</span><span class="n">nuevoVen</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: datos del nuevo vendedor</span>
<span class="sd">        :type nuevoVen: list</span>
<span class="sd">        :return: operacion exitosa</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Graba un vendedor en la base de datos con la información del parámetro</span>
<span class="sd">        Devuelve true si se realiza correctamente, sino false</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into vendedor (dniVendedor, altaVendedor, nombreVendedor, mailVendedor, movilVendedor, &quot;</span>
                          <span class="s2">&quot; delegacionVendedor) VALUES (:dniVendedor, :altaVendedor, :nombreVendedor, :mailVendedor, &quot;</span>
                          <span class="s2">&quot; :movilVendedor, :delegacionVendedor)&quot;</span><span class="p">)</span>
            <span class="n">columnas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dniVendedor&#39;</span><span class="p">,</span> <span class="s1">&#39;altaVendedor&#39;</span><span class="p">,</span> <span class="s1">&#39;nombreVendedor&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;mailVendedor&#39;</span><span class="p">,</span> <span class="s1">&#39;movilVendedor&#39;</span><span class="p">,</span> <span class="s1">&#39;delegacionVendedor&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columnas</span><span class="p">)):</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">nuevoVen</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listadoVendedores">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoVendedores">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoVendedores</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: lista de vendedores</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Devuelve una lista con los datos de los vendedores de la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">searchBtn</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnBuscarven</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">movilven</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtMovilven</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">historicoven</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkHistoricoven</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">searchBtn</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedor WHERE movilVendedor = :movilVendedor ORDER BY idVendedor ASC&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movilVendedor&quot;</span><span class="p">,</span> <span class="n">movilven</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">historicoven</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedor WHERE bajaVendedor is NULL ORDER BY idVendedor ASC &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>
            <span class="k">elif</span> <span class="n">historicoven</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedor ORDER BY idVendedor ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">listado</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado en conexión&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.listarDNIven">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listarDNIven">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listarDNIven</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: lista de vendedores</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Devuelve una lista con los dnis de vendedores existentes en la base de datos</span>
<span class="sd">        para comprobar si ya hay uno</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listaDNIs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;SELECT dniVendedor FROM vendedor&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">listaDNIs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">listaDNIs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.modifVendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modifVendedor">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifVendedor</span><span class="p">(</span><span class="n">modifVen</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: datos del vendedor a modificar</span>
<span class="sd">        :type modifVen: list</span>
<span class="sd">        :return: operacion exitosa</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Modifica los datos de un cliente con los pasados por parámetros</span>
<span class="sd">        Devuelve true si se realiza correctamente, sino false</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">query2</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query2</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE vendedor set altaVendedor = :altaVendedor, nombreVendedor = :nombreVendedor, &quot;</span>
                          <span class="s2">&quot; mailVendedor = :emailVendedor, movilVendedor = :movilVendedor, delegacionVendedor = :delegacionVendedor, &quot;</span>
                          <span class="s2">&quot; bajaVendedor = :bajaVendedor where dniVendedor = :dniVendedor&quot;</span><span class="p">)</span>
            <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dniVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifVen</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:altaVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifVen</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:nombreVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifVen</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:emailVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifVen</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movilVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifVen</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:delegacionVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifVen</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">modifVen</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaVendedor&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query2</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifVen</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query2</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span>  <span class="n">query2</span><span class="o">.</span><span class="n">numRowsAffected</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error modificar vendedor&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.datosOneVendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneVendedor">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneVendedor</span><span class="p">(</span><span class="n">idVen</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: id del vendedor a buscar</span>
<span class="sd">        :type idVen: int</span>
<span class="sd">        :return: datos de un vendedor</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Recupera la información del vendedor cuyo id es el pasado por parámetros</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT idVendedor, dniVendedor, nombreVendedor, altaVendedor, bajaVendedor, movilVendedor, mailVendedor, delegacionVendedor&quot;</span>
                          <span class="s2">&quot; FROM vendedor WHERE idVendedor = :ID&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:ID&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idVen</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos un vendedor&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.datosOneVendedorMovil">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneVendedorMovil">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneVendedorMovil</span><span class="p">(</span><span class="n">movilVen</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: móvil del vendedor</span>
<span class="sd">        :type movilVen: str</span>
<span class="sd">        :return: datos del vendedor</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Recupera los datos de un cliente a partir de su móvil, pasado por parámetro</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT dniVendedor, nombreVendedor, altaVendedor, bajaVendedor, movilVendedor, mailVendedor, delegacionVendedor&quot;</span>
                          <span class="s2">&quot; FROM vendedor WHERE movilVendedor = :movil&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movil&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">movilVen</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos un vendedor&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.bajaVendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaVendedor">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaVendedor</span><span class="p">(</span><span class="n">datos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: datos del vendedor a dar de baja</span>
<span class="sd">        :type datos: list</span>
<span class="sd">        :return: operacion exitosa</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Da de baja al cliente especificado, poniendo la fecha del día actual</span>
<span class="sd">        No elimina al cliente de la base de datos</span>
<span class="sd">        Devuelve true si se realiza correctamente, sino false</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE vendedor set bajaVendedor = :bajaVendedor &quot;</span>
                          <span class="s2">&quot;where dniVendedor = :dniVendedor&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaVendedor&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dniVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">datos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error baja cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Zona facturacion</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="Conexion.altaFactura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaFactura">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaFactura</span><span class="p">(</span><span class="n">factura</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">         :param: dni del cliente y fecha de la factura</span>
<span class="sd">         :type factura: list</span>
<span class="sd">         :return: éxito de la operación</span>
<span class="sd">         :rtype: bool</span>

<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">factura</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">factura</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">factura</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into facturas (fechafac, dnifac) VALUES (:fechaFactura, :dniCliente)&quot;</span><span class="p">)</span>
            <span class="n">columnas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fechaFactura&#39;</span><span class="p">,</span> <span class="s1">&#39;dniCliente&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columnas</span><span class="p">)):</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">factura</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listadoFacturas">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoFacturas">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoFacturas</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: lista de facturas</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Devuelve una lista con los datos de las facturas de la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM facturas ORDER BY id ASC&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado facturas en conexión &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>




<div class="viewcode-block" id="Conexion.eliminarFactura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.eliminarFactura">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eliminarFactura</span><span class="p">(</span><span class="n">numFac</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param: ID de la factura</span>
<span class="sd">        :type numFac: int</span>
<span class="sd">        :return: operacion exitosa</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Elimina de la base de datos esa factura</span>
<span class="sd">        Devuelve true si se realiza correctamente, sino false</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM facturas WHERE id = :id&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="n">numFac</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error eliminar factura&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.datosOneFactura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneFactura">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneFactura</span><span class="p">(</span><span class="n">idFac</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">                :param: ID de la factura</span>
<span class="sd">                :type idFac: int</span>
<span class="sd">                :return: datos de la factura</span>
<span class="sd">                :rtype: list</span>

<span class="sd">                Recupera los datos de una factura y los devuelve en los campos correspondientes</span>

<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT id, fechafac, dnifac&quot;</span>
                          <span class="s2">&quot; FROM facturas WHERE id = :ID&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:ID&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idFac</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos una fac&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.grabarVenta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.grabarVenta">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">grabarVenta</span><span class="p">(</span><span class="n">nuevaventa</span><span class="p">):</span>

        <span class="n">fechaventa</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblFechafac</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">         :param: numero de la factura. codigo de la propiedad y el ID del vendedor</span>
<span class="sd">         :type nuevaventa: list</span>
<span class="sd">         :return: éxito de la operación</span>
<span class="sd">         :rtype: bool</span>

<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into ventas (facventa, codprop, agente)&quot;</span>
                          <span class="s2">&quot; VALUES (:facventa, :codprop, :agente)&quot;</span><span class="p">)</span>
            <span class="n">columnas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;facventa&#39;</span><span class="p">,</span> <span class="s1">&#39;codprop&#39;</span><span class="p">,</span> <span class="s1">&#39;agente&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columnas</span><span class="p">)):</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">columnas</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">nuevaventa</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE propiedades set estadoprop = &#39;Vendido&#39;, bajaprop = :fechafac &quot;</span>
                              <span class="s2">&quot;where idprop = :idprop&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idprop&quot;</span><span class="p">,</span> <span class="n">nuevaventa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:fechafac&quot;</span><span class="p">,</span> <span class="n">fechaventa</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error grabar Venta&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.listadoVentas">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoVentas">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoVentas</span><span class="p">(</span><span class="n">facventa</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: lista de ventas</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Devuelve una lista con los datos de las ventas de la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT v.idventa, v.codprop, p.dirprop, p.muniprop, p.tipoprop, p.prevenprop FROM ventas as v &quot;</span>
                          <span class="s2">&quot;INNER JOIN propiedades as p ON v.codprop = p.idprop where v.facventa = :facventa&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:facventa&quot;</span><span class="p">,</span> <span class="n">facventa</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado ventas en conexión &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.datosOneVenta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneVenta">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneVenta</span><span class="p">(</span><span class="n">idventa</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">                       :param: ID de la venta</span>
<span class="sd">                       :type idventa: int</span>
<span class="sd">                       :return: datos de la venta</span>
<span class="sd">                       :rtype: list</span>

<span class="sd">                       Recupera los datos de una venta y los devuelve en los campos correspondientes</span>

<span class="sd">                       &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;SELECT v.codprop, p.dirprop, p.muniprop, p.tipoprop, p.prevenprop, v.agente &quot;</span>
                <span class="s2">&quot;FROM ventas as v &quot;</span>
                <span class="s2">&quot;INNER JOIN propiedades as p ON v.codprop = p.idprop &quot;</span>
                <span class="s2">&quot;where v.idventa = :idventa&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idventa&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idventa</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos una venta&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Conexion.eliminarVenta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.eliminarVenta">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eliminarVenta</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM ventas WHERE idventa = :id&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE propiedades SET estadoprop= &#39;Disponible&#39;, bajaprop = :baja where idprop = :idprop&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:baja&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">())</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idprop&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error eliminar factura&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">prietogarcia</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navegación</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Código de módulo</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Sergio Prieto Garcia.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>